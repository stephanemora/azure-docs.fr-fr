---
title: Évaluation des vulnérabilités SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Découvrez comment configurer l’évaluation des vulnérabilités SQL et interpréter les rapports d’évaluation sur Azure SQL Database, Azure SQL Managed Instance et Azure Synapse Analytics.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 04/19/2020
tags: azure-synapse
ms.openlocfilehash: dc2270b8b70632a30932c35a8a23d4fc90d976f3
ms.sourcegitcommit: 053e5e7103ab666454faf26ed51b0dfcd7661996
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/27/2020
ms.locfileid: "84030610"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Évaluation des vulnérabilités SQL vous aide à identifier les vulnérabilités de base de données
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Évaluation des vulnérabilités SQL est un service simple à configurer qui découvre, assure le suivi et vous aide à corriger les vulnérabilités de base de données potentielles. Utilisez-le pour améliorer de façon proactive la sécurité de votre base de données.

Évaluation des vulnérabilités fait partie de l’offre [Advanced Data Security](advanced-data-security.md), qui est un package unifié de fonctionnalités de sécurité SQL avancées. Évaluation des vulnérabilités est accessible et peut être gérée par le biais du portail SQL Advanced Data Security central.

> [!NOTE]
> L’évaluation des vulnérabilités est prise en charge pour Azure SQL Database, Azure SQL Managed Instance et Azure Synapse Analytics (anciennement Azure SQL Data Warehouse). Dans cet article, les bases de données d’Azure SQL Database, d’Azure SQL Managed Instance et d’Azure Synapse sont collectivement désignées sous le nom de « bases de données », et le terme « serveur » fait référence au [serveur](logical-servers.md) qui héberge les bases de données d’Azure SQL Database et d’Azure Synapse.

## <a name="vulnerability-assessment"></a>Évaluation des vulnérabilités

Évaluation des vulnérabilités SQL est un service qui offre une visibilité de votre état de sécurité. Évaluation des vulnérabilités comprend des étapes actionnables pour résoudre les problèmes de sécurité et améliorer la sécurité de votre base de données. Elle peut vous aider à :

- Répondre aux exigences de conformité qui nécessitent des rapports d’analyse de la base de données.
- Répondre aux normes de protection des données personnelles.
- Effectuer le monitoring d’un environnement de base de données dynamique, dans lequel les modifications sont difficiles à suivre.

Évaluation des vulnérabilités est un service d’analyse intégré à Azure SQL Database. Le service utilise une base de connaissances de règles qui signalent les failles de sécurité. Il met en évidence les écarts par rapport aux bonnes pratiques, tels que les configurations incorrectes, les autorisations excessives et les données sensibles non protégées.

Les règles sont basées sur les bonnes pratiques de Microsoft et axées sur les problèmes de sécurité qui présentent des risques majeurs pour votre base de données et ses précieuses données. Elles couvrent les problèmes au niveau de la base de données et les problèmes de sécurité au niveau du serveur, comme les paramètres de pare-feu de serveur et les autorisations au niveau du serveur. Elles représentent également la plupart des exigences des différentes instances réglementaires, visant au respect de leurs normes de conformité.

Les résultats de l’analyse sont accompagnés d’étapes actionnables pour résoudre chaque problème et, le cas échéant, de scripts de correction personnalisés. Vous pouvez personnaliser un rapport d’évaluation pour votre environnement en définissant une base de référence acceptable pour :

- Configurations d’autorisations
- Configurations de fonctionnalités
- Paramètres de base de données

## <a name="implement-vulnerability-assessment"></a>Implémenter Évaluation des vulnérabilités

Les étapes suivantes implémentent l’évaluation des vulnérabilités :

### <a name="1-run-a-scan"></a>1. Exécuter une analyse

1. Accédez à votre ressource Azure SQL Database, SQL Managed Instance ou Azure Synapse dans le [portail Azure](https://portal.azure.com).

1. Sous le titre **Sécurité**, sélectionnez **Advanced Data Security**.

1. Cliquez ensuite sur **Sélectionner le stockage** dans le volet **Évaluation des vulnérabilités** afin d’ouvrir le volet des paramètres d’Évaluation des vulnérabilités pour l’ensemble du serveur ou de l’instance gérée.  

1. Configurez un compte de stockage où seront stockés les résultats de l’analyse de toutes les bases de données sur le serveur ou l’instance gérée. Pour plus d’informations sur les comptes de stockage, voir [À propos des comptes Azure Storage](../../storage/common/storage-account-create.md). Une fois le stockage configuré, sélectionnez **Analyser** pour rechercher d’éventuelles vulnérabilités dans votre base de données.

![Analyser une base de données](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > L’analyse est légère et sûre. Elle prend quelques secondes et s’exécute entièrement en lecture seule. Elle n’apporte aucune modification à la base de données.

### <a name="2-view-the-report"></a>2. Afficher le rapport

Quand l’analyse est terminée, votre rapport d’analyse apparaît automatiquement dans le portail Azure. Le rapport présente une vue d’ensemble de votre état de sécurité. Il indique combien de problèmes ont été détectés et leurs gravités respectives. Parmi les résultats figurent des avertissements sur les écarts par rapport aux bonnes pratiques, ainsi qu’une capture des paramètres de sécurité, tels que les rôles et principaux de base de données et les autorisations associées. Le rapport d’analyse fournit également une carte des données sensibles détectées dans votre base de données. Il comprend des recommandations pour classifier ces données à l’aide de la [découverte et de la classification des données](data-discovery-and-classification-overview.md).

![Afficher le rapport](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analyser les résultats et résoudre les problèmes

Passez en revue vos résultats et identifiez ceux qui constituent de véritables problèmes de sécurité dans votre environnement. Explorez chaque résultat ayant entraîné un échec pour comprendre son impact et pourquoi chaque vérification de sécurité a échoué. Utilisez les informations de correction actionnables fournies par le rapport pour résoudre le problème.

![Analyser le rapport](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Définir votre ligne de base

Quand vous examinez les résultats de votre évaluation, vous pouvez marquer certains résultats spécifiques comme *base de référence* acceptable dans votre environnement. La ligne de base est en somme une personnalisation du signalement des résultats. Les résultats correspondant à la ligne de base seront considérés comme corrects lors des analyses ultérieures. Une fois que vous avez établi votre état de sécurité de base, Évaluation des vulnérabilités signale uniquement les écarts par rapport à la base de référence. Ainsi, vous pouvez vous concentrer sur les problèmes pertinents.

![Définir votre ligne de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Exécuter une nouvelle analyse pour afficher le rapport de suivi personnalisé

Après avoir terminé la configuration des **bases de référence de votre règle**, exécutez une nouvelle analyse pour voir le rapport personnalisé. Évaluation des vulnérabilités signale désormais uniquement les problèmes de sécurité qui s’écartent de l’état approuvé de votre base de référence.

![Afficher votre rapport personnalisé](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

Le service Évaluation des vulnérabilités peut désormais être utilisé pour vérifier que votre base de données conserve en permanence un haut niveau de sécurité et que les stratégies de votre entreprise sont respectées. Si des rapports de conformité sont nécessaires, ceux d’Évaluation des vulnérabilités peuvent être utiles pour faciliter le processus de conformité.

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configurer des analyses récurrentes

Accédez aux paramètres d’Évaluation des vulnérabilités pour activer les **analyses récurrentes**. Ce paramètre permet de configurer Évaluation des vulnérabilités pour exécuter automatiquement une analyse sur votre base de données une fois par semaine. Un résumé des résultats d’analyse est envoyé aux adresses e-mail que vous fournissez.

![Afficher votre rapport personnalisé](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exporter un rapport d’évaluation

Sélectionnez **Exporter les résultats d’analyse** pour créer un rapport Excel téléchargeable des résultats de votre analyse. Ce rapport contient un onglet de résumé qui affiche un résumé de l’évaluation. Le rapport comprend tous les contrôles qui ont échoué. Il inclut également un onglet **Résultats** qui contient le jeu complet de résultats de l’analyse. Les résultats incluent tous les contrôles qui ont été exécutés et les détails des résultats de chacun.

### <a name="8-view-scan-history"></a>8. Afficher l’historique d’analyse

Sélectionnez **Historique d’analyse** dans le volet Évaluation des vulnérabilités pour voir un historique de toutes les analyses précédemment exécutées sur cette base de données. Sélectionnez une analyse particulière dans la liste pour afficher les résultats détaillés de cette analyse.

Le service Évaluation des vulnérabilités peut désormais être utilisé pour vérifier que votre base de données conserve en permanence un haut niveau de sécurité et que les stratégies de votre entreprise sont respectées. Si des rapports de conformité sont nécessaires, ceux d’Évaluation des vulnérabilités peuvent être utiles pour faciliter le processus de conformité.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Gérer les évaluations des vulnérabilités avec Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Le module PowerShell Azure Resource Manager est toujours pris en charge, mais tous les développements à venir sont destinés au module Az.Sql. Pour ces cmdlets, voir [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Les arguments des commandes dans le module Az sont sensiblement identiques à ceux des modules AzureRm.

Vous pouvez utiliser les applets de commande Azure PowerShell pour gérer par programmation l’évaluation des vulnérabilités. Les applets de commande prises en charge sont les suivantes :

| Nom de l’applet de commande sous forme de lien | Description |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Efface la base de référence de la règle d’Évaluation des vulnérabilités.<br/>Définissez d’abord la base de référence avant d’utiliser cette applet de commande pour l’effacer. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Efface les paramètres d’Évaluation des vulnérabilités d’une base de données. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Convertit les résultats d’analyse d’Évaluation des vulnérabilités en fichier Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtient la base de référence de la règle d’Évaluation des vulnérabilités pour une règle donnée. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtient tous les enregistrements d’analyse d’Évaluation des vulnérabilités associés à une base de données. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Retourne les paramètres d’Évaluation des vulnérabilités d’une base de données. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Définit la base de référence de la règle d’Évaluation des vulnérabilités. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Déclenche le démarrage d’une analyse d’Évaluation des vulnérabilités. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Met à jour les paramètres d’Évaluation des vulnérabilités d’une base de données. |
| &nbsp; | &nbsp; |

Pour obtenir un exemple de script, consultez [Azure SQL Vulnerability Assessment PowerShell support](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Gérer les règles de référence d’Évaluation des vulnérabilités à l’aide de modèles Resource Manager

Pour configurer des règles de base d’évaluation des vulnérabilités à l’aide de modèles Azure Resource Manager, utilisez le type `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Vérifiez que vous avez activé `vulnerabilityAssessments` avant d’ajouter des lignes de base.

Voici un exemple de définition de la règle de référence VA2065 sur masterdb et VA1143 sur userdb comme ressources dans un modèle Resource Manager :

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Pour la base de données MASTER et la base de données utilisateur, les noms de ressources sont définis différemment :

- Base de données MASTER - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
- Base de données utilisateur - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",

Pour gérer des types booléens comme true/false, définissez le résultat de la base de référence avec une entrée binaire comme "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Étapes suivantes  

- Apprenez-en davantage sur [Advanced Data Security](advanced-data-security.md).
- Apprenez-en davantage sur la [découverte et la classification des données](data-discovery-and-classification-overview.md).
